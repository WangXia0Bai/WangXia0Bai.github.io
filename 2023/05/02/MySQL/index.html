

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/logo.png">
  <link rel="icon" href="/img/logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="王小白">
  <meta name="keywords" content="">
  
    <meta name="description" content="#MySQL ##MySQL入门 一、连接数据库找到C:\Program Files\MySQL\MySQL Server 8.0\bin(mysql安装的位置)，打开命令窗口，输入： mysql -h localhost -u root -p \Enter  password(root)  \Enter 图形化界面软件 NaviCat 二、结构化查询语言sql1、分类   名称 描述 命令">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL">
<meta property="og:url" content="http://example.com/2023/05/02/MySQL/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="#MySQL ##MySQL入门 一、连接数据库找到C:\Program Files\MySQL\MySQL Server 8.0\bin(mysql安装的位置)，打开命令窗口，输入： mysql -h localhost -u root -p \Enter  password(root)  \Enter 图形化界面软件 NaviCat 二、结构化查询语言sql1、分类   名称 描述 命令">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-05-02T07:32:31.000Z">
<meta property="article:modified_time" content="2023-05-02T07:33:46.065Z">
<meta property="article:author" content="王小白">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>MySQL - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>王小白的神奇喵喵屋</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" target="_blank" rel="noopener" href="https://chat-gpt-next-web-wangxia0bai.vercel.app/">
                <i class="iconfont icon-chat-fill"></i>
                <span>ChatGPT</span>
              </a>
            </li>
          
        
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/wallpaper2.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MySQL"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-05-02 15:32" pubdate>
          2023年5月2日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          26k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          214 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MySQL</h1>
            
            
              <div class="markdown-body">
                
                <p>#MySQL</p>
<p>##MySQL入门</p>
<h3 id="一、连接数据库"><a href="#一、连接数据库" class="headerlink" title="一、连接数据库"></a>一、连接数据库</h3><p>找到C:\Program Files\MySQL\MySQL Server 8.0\bin(mysql安装的位置)，打开命令窗口，输入：</p>
<p>mysql -h localhost -u root -p \Enter </p>
<p>password(root)  \Enter</p>
<p>图形化界面软件 NaviCat</p>
<h3 id="二、结构化查询语言sql"><a href="#二、结构化查询语言sql" class="headerlink" title="二、结构化查询语言sql"></a>二、结构化查询语言sql</h3><h4 id="1、分类"><a href="#1、分类" class="headerlink" title="1、分类"></a>1、分类</h4><table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
<th>命令</th>
</tr>
</thead>
<tbody><tr>
<td>数据定义语言DDL</td>
<td>数据库、数据表的创建修改和删除</td>
<td>CREATE、ALTER、DROP</td>
</tr>
<tr>
<td>数据操作语言DML</td>
<td>数据的增加、修改和删除</td>
<td>INSERT、UPDATE、DELETE</td>
</tr>
<tr>
<td>数据查询语言DQL</td>
<td>数据的查询</td>
<td>SELECT</td>
</tr>
<tr>
<td>数据控制语言DCL</td>
<td>用户授权、事务的提交和回滚</td>
<td>GRANT、COMMIT、ROLLBACK</td>
</tr>
</tbody></table>
<h3 id="三、数据库的操作"><a href="#三、数据库的操作" class="headerlink" title="三、数据库的操作"></a>三、数据库的操作</h3><h4 id="1、创建的语法"><a href="#1、创建的语法" class="headerlink" title="1、创建的语法"></a>1、创建的语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> 数据库名称 <span class="hljs-keyword">DEFAULT</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> 字符集 <span class="hljs-keyword">COLLATE</span> 排序规则；<br></code></pre></td></tr></table></figure>

<p><font color = RED>示例</font>：创建数据库<code>lesson</code>，并指定字符集为<code>GBK</code>，排序规则为<code>GBK_CHINESE_CI</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> Lesson <span class="hljs-keyword">DEFAULT</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> GBK <span class="hljs-keyword">COLLATE</span> GBK_CHINESE_CI;<br></code></pre></td></tr></table></figure>



<h4 id="2、修改的语法"><a href="#2、修改的语法" class="headerlink" title="2、修改的语法"></a>2、修改的语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> DATABASE 数据库名称 <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> 字符集 <span class="hljs-keyword">COLLATE</span> 排序规则；<br></code></pre></td></tr></table></figure>

<p><font color = RED>示例</font>：修改数据库lesson的字符集为<code>UTF8</code>，排序规则为<code>UTF8_GENERAL_CI</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> DATABASE Lesson <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> UTF8  <span class="hljs-keyword">COLLATE</span> UTF8_GENERAL_CI;<br></code></pre></td></tr></table></figure>



<h4 id="3、删除的语法"><a href="#3、删除的语法" class="headerlink" title="3、删除的语法"></a>3、删除的语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> DATABASE [IF <span class="hljs-keyword">EXISTS</span>] 数据库名称；<br></code></pre></td></tr></table></figure>

<p><font color = RED>示例</font>：删除数据库lesson</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> DATABASE IF <span class="hljs-keyword">EXISTS</span> lesson;<br></code></pre></td></tr></table></figure>



<h4 id="4、查看的语法"><a href="#4、查看的语法" class="headerlink" title="4、查看的语法"></a>4、查看的语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> DATABASES;<br></code></pre></td></tr></table></figure>



<h4 id="5、使用的语法"><a href="#5、使用的语法" class="headerlink" title="5、使用的语法"></a>5、使用的语法</h4><p>使用数据库，也可以理解为切换（选择）数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">USE 数据库名称;<br></code></pre></td></tr></table></figure>

<p><font color = RED>示例</font>：使用数据库lesson</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">USE lesson;<br></code></pre></td></tr></table></figure>



<h3 id="四、数据类型"><a href="#四、数据类型" class="headerlink" title="四、数据类型"></a>四、数据类型</h3><h4 id="1、数值类型"><a href="#1、数值类型" class="headerlink" title="1、数值类型"></a>1、数值类型</h4><table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">大小</th>
<th align="left">范围（有符号）</th>
<th align="left">范围（无符号）</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">TINYINT</td>
<td align="left">1 Bytes</td>
<td align="left">(-128，127)</td>
<td align="left">(0，255)</td>
<td align="left">小整数值</td>
</tr>
<tr>
<td align="left">SMALLINT</td>
<td align="left">2 Bytes</td>
<td align="left">(-32 768，32 767)</td>
<td align="left">(0，65 535)</td>
<td align="left">大整数值</td>
</tr>
<tr>
<td align="left">MEDIUMINT</td>
<td align="left">3 Bytes</td>
<td align="left">(-8 388 608，8 388 607)</td>
<td align="left">(0，16 777 215)</td>
<td align="left">大整数值</td>
</tr>
<tr>
<td align="left">INT或INTEGER</td>
<td align="left">4 Bytes</td>
<td align="left">(-2 147 483 648，2 147 483 647)</td>
<td align="left">(0，4 294 967 295)</td>
<td align="left">大整数值</td>
</tr>
<tr>
<td align="left">BIGINT</td>
<td align="left">8 Bytes</td>
<td align="left">(-9,223,372,036,854,775,808，9 223 372 036 854 775 807)</td>
<td align="left">(0，18 446 744 073 709 551 615)</td>
<td align="left">极大整数值</td>
</tr>
<tr>
<td align="left">FLOAT</td>
<td align="left">4 Bytes</td>
<td align="left">(-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38)</td>
<td align="left">0，(1.175 494 351 E-38，3.402 823 466 E+38)</td>
<td align="left">单精度 浮点数值</td>
</tr>
<tr>
<td align="left">DOUBLE</td>
<td align="left">8 Bytes</td>
<td align="left">(-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td>
<td align="left">0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td>
<td align="left">双精度 浮点数值</td>
</tr>
<tr>
<td align="left">DECIMAL</td>
<td align="left">对DECIMAL(M,D) ，如果M&gt;D，为M+2否则为D+2</td>
<td align="left">依赖于M和D的值</td>
<td align="left">依赖于M和D的值</td>
<td align="left">小数值</td>
</tr>
</tbody></table>
<h4 id="2、日期和时间类型"><a href="#2、日期和时间类型" class="headerlink" title="2、日期和时间类型"></a>2、日期和时间类型</h4><table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">大小 ( bytes)</th>
<th align="left">范围</th>
<th align="left">格式</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">DATE</td>
<td align="left">3</td>
<td align="left">1000-01-01&#x2F;9999-12-31</td>
<td align="left">YYYY-MM-DD</td>
<td align="left">日期值</td>
</tr>
<tr>
<td align="left">TIME</td>
<td align="left">3</td>
<td align="left">‘-838:59:59’&#x2F;‘838:59:59’</td>
<td align="left">HH:MM:SS</td>
<td align="left">时间值或持续时间</td>
</tr>
<tr>
<td align="left">YEAR</td>
<td align="left">1</td>
<td align="left">1901&#x2F;2155</td>
<td align="left">YYYY</td>
<td align="left">年份值</td>
</tr>
<tr>
<td align="left">DATETIME</td>
<td align="left">8</td>
<td align="left">‘1000-01-01 00:00:00’ 到 ‘9999-12-31 23:59:59’</td>
<td align="left">YYYY-MM-DD hh:mm:ss</td>
<td align="left">混合日期和时间值</td>
</tr>
<tr>
<td align="left">TIMESTAMP</td>
<td align="left">4</td>
<td align="left">‘1970-01-01 00:00:01’ UTC 到 ‘2038-01-19 03:14:07’ UTC结束时间是第 <strong>2147483647</strong> 秒，北京时间 <strong>2038-1-19 11:14:07</strong>，格林尼治时间 2038年1月19日 凌晨 03:14:07</td>
<td align="left">YYYY-MM-DD hh:mm:ss</td>
<td align="left">混合日期和时间值，时间戳</td>
</tr>
</tbody></table>
<h4 id="3、字符串类型"><a href="#3、字符串类型" class="headerlink" title="3、字符串类型"></a>3、字符串类型</h4><table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">大小</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CHAR</td>
<td align="left">0-255 bytes</td>
<td align="left">定长字符串（方便查找但是浪费空间）</td>
</tr>
<tr>
<td align="left">VARCHAR</td>
<td align="left">0-65535 bytes</td>
<td align="left">变长字符串</td>
</tr>
<tr>
<td align="left">TINYBLOB</td>
<td align="left">0-255 bytes</td>
<td align="left">不超过 255 个字符的二进制字符串</td>
</tr>
<tr>
<td align="left">TINYTEXT</td>
<td align="left">0-255 bytes</td>
<td align="left">短文本字符串</td>
</tr>
<tr>
<td align="left">BLOB</td>
<td align="left">0-65 535 bytes</td>
<td align="left">二进制形式的长文本数据</td>
</tr>
<tr>
<td align="left">TEXT</td>
<td align="left">0-65 535 bytes</td>
<td align="left">长文本数据</td>
</tr>
<tr>
<td align="left">MEDIUMBLOB</td>
<td align="left">0-16 777 215 bytes</td>
<td align="left">二进制形式的中等长度文本数据</td>
</tr>
<tr>
<td align="left">MEDIUMTEXT</td>
<td align="left">0-16 777 215 bytes</td>
<td align="left">中等长度文本数据</td>
</tr>
<tr>
<td align="left">LONGBLOB</td>
<td align="left">0-4 294 967 295 bytes</td>
<td align="left">二进制形式的极大文本数据</td>
</tr>
<tr>
<td align="left">LONGTEXT</td>
<td align="left">0-4 294 967 295 bytes</td>
<td align="left">极大文本数据</td>
</tr>
</tbody></table>
<p><font color = BLue><strong>注意</strong></font>：<code>char(n) </code>和<code> varchar(n)</code> 中括号中 n 代表字符的个数，并不代表字节个数，比如<code>CHAR(30)</code>就可以存储 30 个字符。<br>            <code>CHAR</code> 和 <code>VARCHAR </code>类型类似，但它们保存和检索的方式不同。它们的最大长度和是否尾部空格被保留等方面也不同。在存储或检			索过程中不进行大小写转换。</p>
<h3 id="五、数据库定义语言（DDL）"><a href="#五、数据库定义语言（DDL）" class="headerlink" title="五、数据库定义语言（DDL）"></a>五、数据库定义语言（DDL）</h3><h4 id="1、数据表类型"><a href="#1、数据表类型" class="headerlink" title="1、数据表类型"></a>1、数据表类型</h4><p><code>MyISAM、InnoDB、HEAP、BOB、CSV</code>等。</p>
<ul>
<li><strong>MyISAM：</strong>MySQL5.5之前的默认存储引擎，在插入和查询的情况下性能很高，但是它不支持事务，只能添加表级锁。</li>
<li><strong>InnoDB：</strong>MySQL5.5之后的默认存储引擎，它支持ACID事务、行级锁、外键，但是性能比不过MyISAM，更加消耗资源。</li>
<li><strong>Memory：</strong>数据都存放在内存中，数据库重启或发生崩溃，表中的数据都将消失。</li>
</ul>
<p>们可以这样来查看支持的引擎：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> ENGINES;<br></code></pre></td></tr></table></figure>

<p>MySQL默认采用的是Innodb引擎，我们也可以去修改为其他的引擎。</p>
<p>####2、列级约束条件</p>
<p>列级约束有六种：主键Primary key、外键foreign key 、唯一 unique、检查 check （MySQL不支持）、默认default 、非空&#x2F;空值 not null&#x2F; null</p>
<p>####3、表级约束条件</p>
<p>表级约束有四种：主键、外键、唯一、检查</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">[<span class="hljs-keyword">CONSTRAINT</span> <span class="hljs-operator">&lt;</span>外键名<span class="hljs-operator">&gt;</span>] <span class="hljs-keyword">FOREIGN</span> KEY 字段名 [，字段名<span class="hljs-number">2</span>，…] <span class="hljs-keyword">REFERENCES</span> <span class="hljs-operator">&lt;</span>主表名<span class="hljs-operator">&gt;</span> 主键列<span class="hljs-number">1</span> [，主键列<span class="hljs-number">2</span>，…]<br></code></pre></td></tr></table></figure>





<h4 id="4、MyISAM和InnoDB的区别"><a href="#4、MyISAM和InnoDB的区别" class="headerlink" title="4、MyISAM和InnoDB的区别"></a>4、MyISAM和InnoDB的区别</h4><table>
<thead>
<tr>
<th><font face = "宋体">名称</font></th>
<th><font face = "宋体">MyISAM</font></th>
<th><font face = "宋体">InnoDB</font></th>
</tr>
</thead>
<tbody><tr>
<td>事务处理</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>数据行锁定</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>外键约束</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>全文索引</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>表空间大小</td>
<td>较小</td>
<td>较大,约2倍</td>
</tr>
</tbody></table>
<p>事务：涉及的所有操作是一个整体，要么都执行，要么都不执行。</p>
<p>数据行锁定：一行数据，当一个用户在修改它时，可以直接将该数据锁定。</p>
<p><strong>如何选择？</strong></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">当涉及的业务已查询为主，而修改和删除较少时，使用MyISAM，InnoDB反之。<br></code></pre></td></tr></table></figure>



<h4 id="4、创建数据表"><a href="#4、创建数据表" class="headerlink" title="4、创建数据表"></a>4、创建数据表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> 数据表名称(<br>	字段名<span class="hljs-number">1</span> 列类型（长度） [修饰属性] [键<span class="hljs-operator">/</span>索引] [注释],<br>    字段名<span class="hljs-number">2</span> 列类型（长度） [修饰属性] [键<span class="hljs-operator">/</span>索引] [注释],<br>	字段名<span class="hljs-number">3</span> 列类型（长度） [修饰属性] [键<span class="hljs-operator">/</span>索引] [注释],<br>	...<br>    字段名n 列类型（长度） [修饰属性] [键<span class="hljs-operator">/</span>索引] [注释],<br>)[ENGINE <span class="hljs-operator">=</span> 数据表的类型] [CHARSET <span class="hljs-operator">=</span> 字符集编码] [COMMENT <span class="hljs-operator">=</span> 注释];<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：创建学生表，表中有字段学号、姓名、性别，</p>
<p>​			创建教师表，表中有字段编号、姓名，</p>
<p>​			创建课表，表中有字段学生编号、教师编号。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> student (<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> sid <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> key <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> sex enum(<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;男&#x27;</span>);<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> teacher (<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> tid <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> key,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>);<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> teach (<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> tid <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> sid <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>);<br></code></pre></td></tr></table></figure>



<h4 id="5、修改数据表"><a href="#5、修改数据表" class="headerlink" title="5、修改数据表"></a>5、修改数据表</h4><ul>
<li><strong>修改表名</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 RENAME <span class="hljs-keyword">AS</span> 新表名;<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：将student表名修改为stu</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> student RENAME <span class="hljs-keyword">AS</span> stu;<br></code></pre></td></tr></table></figure>



<ul>
<li><strong>增加字段</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 <span class="hljs-keyword">ADD</span> 字段名 列类型（长度） [修饰属性] [键<span class="hljs-operator">/</span>索引] [注释];<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：将表teach增加外键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> teach<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> f_sid <span class="hljs-keyword">FOREIGN</span> KEY (sid) <span class="hljs-keyword">REFERENCES</span> student (sid),<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> f_tid <span class="hljs-keyword">FOREIGN</span> KEY (tid) <span class="hljs-keyword">REFERENCES</span> teacher (tid);<br></code></pre></td></tr></table></figure>



<ul>
<li><strong>查看表结构</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DESC</span> 表名; <span class="hljs-comment">-- 查看表结构</span><br></code></pre></td></tr></table></figure>



<ul>
<li><strong>修改字段</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- MODIFY 只能修改字段的修饰属性</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 MODIFY 字段名 列类型（长度） [修饰属性] [键<span class="hljs-operator">/</span>索引] [注释];<br><span class="hljs-comment">-- CHANGE 可以修改字段名和修饰属性</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 CHANGE 字段名 新字段名 列类型（长度) [修饰属性] [键<span class="hljs-operator">/</span>索引] [注释];<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：将stu中<code>sex</code>字段的类型设置为<code>VARCHAR</code>，长度为2，默认值为’男’，注释。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stu MODIFY sex <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;男&#x27;</span> COMMENT <span class="hljs-string">&#x27;男, 女, 其他&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：将stu中phone字段修改为mobile，其余不变。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stu MODIFY sex <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;男&#x27;</span> COMMENT <span class="hljs-string">&#x27;男, 女, 其他&#x27;</span>;<br></code></pre></td></tr></table></figure>



<ul>
<li><strong>删除字段</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 <span class="hljs-keyword">DROP</span> 字段名;<br><br>#或者<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">COLUMN</span> 列名[restrict<span class="hljs-operator">|</span>cascade];<br></code></pre></td></tr></table></figure>

<p>我们可以通过ADD来添加一个新的列，通过DROP来删除一个列，不过我们可以添加restrict或cascade，默认是restrict，表示如果此列作为其他表的约束或视图引用到此列时，将无法删除，而cascade会强制连带引用此列的约束、视图一起删除。还可以通过ALTER来修改此列的属性。</p>
<ul>
<li><strong>删除数据表</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> 表名 [restrict<span class="hljs-operator">|</span>cascade];<br></code></pre></td></tr></table></figure>

<p>其中restrict和cascade上面的效果一致。</p>
<h3 id="六、数据库操纵语言（DML）"><a href="#六、数据库操纵语言（DML）" class="headerlink" title="六、数据库操纵语言（DML）"></a>六、数据库操纵语言（DML）</h3><h4 id="1、什么是DML"><a href="#1、什么是DML" class="headerlink" title="1、什么是DML"></a>1、什么是DML</h4><p>数据操作语言，增删改查。</p>
<h4 id="2、INSERT语句"><a href="#2、INSERT语句" class="headerlink" title="2、INSERT语句"></a>2、INSERT语句</h4><p>如果插入的数据与列一一对应，那么可以省略列名，但是如果希望向指定列上插入数据，就需要给出列名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">一般写法：<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> 表名 (字段名<span class="hljs-number">1</span>， 字段名<span class="hljs-number">2</span>， 字段名<span class="hljs-number">3.</span>..)<span class="hljs-keyword">VALUES</span>(字段值<span class="hljs-number">1</span>, 字段值<span class="hljs-number">2</span>, 字段值<span class="hljs-number">3.</span>..);<br><span class="hljs-comment">-- 注意，VALUES后的字段值必须与表的字段名一一对应。</span><br>省略写法：<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> 表名 <span class="hljs-keyword">VALUES</span>(字段值<span class="hljs-number">1</span>, 字段值<span class="hljs-number">2</span>, 字段值<span class="hljs-number">3.</span>..);<br></code></pre></td></tr></table></figure>

<p>我们也可以一次性向数据库中插入多条数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">/*一次插入多条数据*/</span><br>一般写法：<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> 表名 (字段名<span class="hljs-number">1</span>， 字段名<span class="hljs-number">2</span>， 字段名<span class="hljs-number">3.</span>..)<span class="hljs-keyword">VALUES</span>(字段值<span class="hljs-number">1</span>, 字段值<span class="hljs-number">2</span>, 字段值<span class="hljs-number">3.</span>..),(字段值<span class="hljs-number">1</span>, 字段值<span class="hljs-number">2</span>, 字段值<span class="hljs-number">3.</span>..)..;<br><span class="hljs-comment">-- 注意，VALUES后的字段值必须与表的字段名一一对应。</span><br>省略写法：<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> 表名 <span class="hljs-keyword">VALUES</span>(字段值<span class="hljs-number">1</span>, 字段值<span class="hljs-number">2</span>, 字段值<span class="hljs-number">3.</span>..),(字段值<span class="hljs-number">1</span>, 字段值<span class="hljs-number">2</span>, 字段值<span class="hljs-number">3.</span>..)...;<br></code></pre></td></tr></table></figure>



<p><font color = "blue">示例</font>：向创建的student表中添加数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1110</span> ,<span class="hljs-string">&#x27;小明&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>),<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> (<span class="hljs-number">1111</span>, <span class="hljs-string">&#x27;小强&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>),<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> (<span class="hljs-number">1112</span>, <span class="hljs-string">&#x27;小红&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>);<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student (sid, name, sex) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1113</span> ,<span class="hljs-string">&#x27;小芳&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>);<br></code></pre></td></tr></table></figure>



<h4 id="3、UPDATE语句"><a href="#3、UPDATE语句" class="headerlink" title="3、UPDATE语句"></a>3、UPDATE语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> 表名 <span class="hljs-keyword">SET</span> 字段名<span class="hljs-number">1</span> <span class="hljs-operator">=</span> 字段值<span class="hljs-number">1</span> [, 字段名<span class="hljs-number">2</span> <span class="hljs-operator">=</span> 字段值<span class="hljs-number">2</span>, ...] [<span class="hljs-keyword">WHERE</span> 修改条件];<br></code></pre></td></tr></table></figure>

<h5 id="3-1-WHERE子语句"><a href="#3-1-WHERE子语句" class="headerlink" title="3.1 WHERE子语句"></a>3.1 WHERE子语句</h5><p>注意，SQL语句中的等于判断是<code>=</code></p>
<p>判断条件用关系运算符<code>&gt;，&lt;，&gt;=，&lt;=，!=</code>来表示。</p>
<p>逻辑运算符通常用<code>AND(&amp;&amp;)，OR(||)</code>来表示。</p>
<p><strong>警告：</strong>如果忘记添加<code>WHERE</code>字句来限定条件，将使得整个表中此列的所有数据都被修改！</p>
<p><font color = "blue">示例</font>：将学生学号为1111的学生的性别更新为女。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">UPDATE</span> student <span class="hljs-keyword">SET</span> sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;女&#x27;</span> <span class="hljs-keyword">WHERE</span> sid <span class="hljs-operator">=</span> <span class="hljs-number">1111</span>;<br></code></pre></td></tr></table></figure>



<h4 id="4、DELETE语句"><a href="#4、DELETE语句" class="headerlink" title="4、DELETE语句"></a>4、DELETE语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> 表名 [<span class="hljs-keyword">WHERE</span> 删除条件];<br></code></pre></td></tr></table></figure>



<h4 id="5、TRUNCATE语句"><a href="#5、TRUNCATE语句" class="headerlink" title="5、TRUNCATE语句"></a>5、TRUNCATE语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 清空数据</span><br><span class="hljs-keyword">TRUNCATE</span> [<span class="hljs-keyword">TABLE</span>] 表名;<br></code></pre></td></tr></table></figure>

<h5 id="5-1-DELETE-和-TRUNCATE的区别"><a href="#5-1-DELETE-和-TRUNCATE的区别" class="headerlink" title="5.1 DELETE 和 TRUNCATE的区别"></a>5.1 DELETE 和 TRUNCATE的区别</h5><ul>
<li>全部清空<code>TRUNCATE</code>效率高；</li>
<li>如果表中有自增长列，<code>TRUNCATE</code>会重置自增长计数器，但<code>DEL</code>不会；</li>
<li><code>TRUNCATE</code>无法恢复，而<code>DEL</code>可以使用事务回滚恢复。</li>
</ul>
<p>###七、数据库查询语言（DQL）</p>
<h4 id="1、什么是DQL"><a href="#1、什么是DQL" class="headerlink" title="1、什么是DQL"></a>1、什么是DQL</h4><p>数据库查询语言（DQL）</p>
<p>数据库的查询是我们整个数据库学习中的重点内容，面对数据库中庞大的数据，该如何去寻找我们想要的数据，就是我们主要讨论的问题。</p>
<h4 id="2、单表查询"><a href="#2、单表查询" class="headerlink" title="2、单表查询"></a>2、单表查询</h4><p>单表查询是最简单的一种查询，我们只需要在一张表中去查找数据即可，通过使用<code>select</code>语句来进行单表查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 指定查询某一列数据</span><br><span class="hljs-keyword">SELECT</span> 列名[,列名<span class="hljs-number">1.</span>..] <span class="hljs-keyword">FROM</span> 表名<br><span class="hljs-comment">-- 会以别名显示此列</span><br><span class="hljs-keyword">SELECT</span> 列名 别名 <span class="hljs-keyword">FROM</span> 表名<br><span class="hljs-comment">-- 查询所有的列数据</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 表名<br><span class="hljs-comment">-- 只查询不重复的值</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> 列名 <span class="hljs-keyword">FROM</span> 表名<br></code></pre></td></tr></table></figure>

<p>我们也可以添加<code>where</code>字句来限定查询目标：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 条件<br></code></pre></td></tr></table></figure>

<p>#####2.1、常用查询条件</p>
<ul>
<li>一般的比较运算符，包括&#x3D;、&gt;、&lt;、&gt;&#x3D;、&lt;&#x3D;、!&#x3D;等。</li>
<li>是否在集合中：in（包括）、not in（不包括）</li>
<li>字符模糊匹配：like（匹配），not like（不匹配）</li>
<li>多重条件连接查询：and(&amp;&amp;)、or(||)、not</li>
</ul>
<p><font color = "blue">示例</font>：查询student表中学号以11开头且性别为男的学生。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">WHERE</span> sid <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;11%&#x27;</span> <span class="hljs-operator">&amp;&amp;</span> sex <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;男&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br><span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span> 小明 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1112</span> <span class="hljs-operator">|</span> 小刚 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br></code></pre></td></tr></table></figure>

<p><code>%</code>是表示任意数据，与<code>like</code>搭配使用：</p>
<ul>
<li>‘%XXX’表示结尾是XXX，</li>
<li>‘%XXX%’表示中间是XXX，</li>
<li>‘XXX%’表示开头是XXX。</li>
</ul>
<h4 id="3、排序查询"><a href="#3、排序查询" class="headerlink" title="3、排序查询"></a>3、排序查询</h4><p>我们可以通过<code>order by</code>来将查询结果进行排序：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 条件 <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 列名 <span class="hljs-keyword">ASC</span><span class="hljs-operator">|</span><span class="hljs-keyword">DESC</span><br></code></pre></td></tr></table></figure>

<p>使用ASC表示升序排序，使用DESC表示降序排序，默认为升序。</p>
<p>我们也可以可以同时添加多个排序：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 条件 <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 列名<span class="hljs-number">1</span> <span class="hljs-keyword">ASC</span><span class="hljs-operator">|</span><span class="hljs-keyword">DESC</span>, 列名<span class="hljs-number">2</span> <span class="hljs-keyword">ASC</span><span class="hljs-operator">|</span><span class="hljs-keyword">DESC</span><br></code></pre></td></tr></table></figure>

<p>这样会先按照列名1进行排序，每组列名1相同的数据再按照列名2排序。</p>
<p><font color = "blue">示例</font>：查询先按照性别排序，再按照学号降序排序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sex <span class="hljs-keyword">asc</span>, sid <span class="hljs-keyword">desc</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br><span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2110</span> <span class="hljs-operator">|</span> 小强 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1112</span> <span class="hljs-operator">|</span> 小刚 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span> 小明 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2111</span> <span class="hljs-operator">|</span> 小丽 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1113</span> <span class="hljs-operator">|</span> 小芳 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1111</span> <span class="hljs-operator">|</span> 小红 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br></code></pre></td></tr></table></figure>



<p>####4、聚集函数</p>
<p>聚集函数一般用作统计，包括：</p>
<ul>
<li><code>count(*)</code>统计所有的行数 (count与括号之前不能有空格)</li>
<li><code>count([distinct]列名)</code>统计某列的值总和（distinct表示去重再统计，下同）</li>
<li><code>sum([distinct]列名)</code>求一列的和（注意必须是数字类型的）</li>
<li><code>avg([distinct]列名)</code>求一列的平均值（注意必须是数字类型）</li>
<li><code>max([distinct]列名)</code>求一列的最大值</li>
<li><code>min([distinct]列名)</code>求一列的最小值</li>
</ul>
<p>一般聚集函数是这样使用的：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> 列名) <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 条件 <br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：统计sex列一共有去重后有多少行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> sex) <span class="hljs-keyword">FROM</span> student;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> sex) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------+</span><br><span class="hljs-operator">|</span>                   <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------+</span><br></code></pre></td></tr></table></figure>

<p>#####4.1分组和分页查询</p>
<p>通过使用<code>group by</code>来对查询结果进行分组，它需要结合聚合函数一起使用：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">sum</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 条件 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 列名<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：分性别统计学生人数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>),sex <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> sex;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------+-----+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+-----+</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">3</span> <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">3</span> <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+-----+</span><br></code></pre></td></tr></table></figure>

<p>我们还可以添加<code>having</code>来限制分组条件：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">sum</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 条件 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 列名 <span class="hljs-keyword">HAVING</span> 约束条件<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：统计男学生人数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>),sex <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> sex <span class="hljs-keyword">HAVING</span> sex<span class="hljs-operator">=</span><span class="hljs-string">&#x27;男&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------+-----+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+-----+</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">3</span> <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+-----+</span><br></code></pre></td></tr></table></figure>

<p>我们可以通过<code>limit</code>来限制查询的数量，只取前n个结果：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 表名 LIMIT 数量<br></code></pre></td></tr></table></figure>

<p>我们也可以进行分页：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 表名 LIMIT 起始位置（从<span class="hljs-number">0</span>开始）,数量<br></code></pre></td></tr></table></figure>



<p>####5、多表查询</p>
<p>多表查询是同时查询的两个或两个以上的表，多表查询会提通过连接转换为单表查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 表<span class="hljs-number">1</span>, 表<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<p>直接这样查询会得到两张表的笛卡尔积，也就是每一项数据和另一张表的每一项数据都结合一次，会产生庞大的数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 表<span class="hljs-number">1</span>, 表<span class="hljs-number">2</span> <span class="hljs-keyword">WHERE</span> 条件<br></code></pre></td></tr></table></figure>

<p>这样，只会从笛卡尔积的结果中得到满足条件的数据。</p>
<p>![img](D:\Typora\笔记\C++\Boost.Asio C++ NP\images\resize,m_lfit,w_220,h_220,limit_1.gif)</p>
<p><strong>注意：</strong>如果两个表中都带有此属性吗，需要添加表名前缀来指明是哪一个表的数据。</p>
<p><font color = "blue">示例</font>：查询student和teacher表，满足teacher表中的tid为1。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student, teacher <span class="hljs-keyword">WHERE</span> teacher.tid <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+-----+------+------+</span><br><span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span> tid <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+-----+------+------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span> 小明 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span> 张三 <span class="hljs-operator">|</span> 男   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1111</span> <span class="hljs-operator">|</span> 小红 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span> 张三 <span class="hljs-operator">|</span> 男   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1112</span> <span class="hljs-operator">|</span> 小刚 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span> 张三 <span class="hljs-operator">|</span> 男   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1113</span> <span class="hljs-operator">|</span> 小芳 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span> 张三 <span class="hljs-operator">|</span> 男   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2110</span> <span class="hljs-operator">|</span> 小强 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span> 张三 <span class="hljs-operator">|</span> 男   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2111</span> <span class="hljs-operator">|</span> 小丽 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span> 张三 <span class="hljs-operator">|</span> 男   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+-----+------+------+</span><br></code></pre></td></tr></table></figure>



<p>#####5.1 自身连接查询</p>
<p>自身连接，就是将表本身和表进行笛卡尔积计算，得到结果，但是由于表名相同，因此要先起一个别名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 表名 别名<span class="hljs-number">1</span>, 表名 别名<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<p>其实自身连接查询和前面的是一样的，只是连接对象变成自己和自己了。</p>
<p>#####5.2 外连接查询</p>
<p>外连接就是专门用于联合查询情景的，比如现在有一个存储所有用户的表，还有一张用户详细信息的表，我希望将这两张表结合到一起来查看完整的数据，我们就可以通过使用外连接来进行查询，外连接有三种方式：</p>
<ul>
<li>通过使用<code>inner join</code>进行内连接，只会返回两个表满足条件的交集部分：</li>
</ul>
<p>![在这里插入图片描述](D:\Typora\笔记\C++\Boost.Asio C++ NP\images\watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg1ODIwMQ&#x3D;&#x3D;,size_16,color_FFFFFF,t_70.png)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 表<span class="hljs-number">1</span> <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> 表<span class="hljs-number">2</span> <span class="hljs-keyword">ON</span> 合并条件<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：查询表student和teach的以学号合并的交集（只有student中有的sid和teach表中有的sid才会被查询到）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> teach <span class="hljs-keyword">ON</span> student.sid <span class="hljs-operator">=</span> teach.sid;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+-----+------+</span><br><span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span> tid <span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+-----+------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span> 小明 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1111</span> <span class="hljs-operator">|</span> 小红 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span>   <span class="hljs-number">2</span> <span class="hljs-operator">|</span> <span class="hljs-number">1111</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+-----+------+</span><br></code></pre></td></tr></table></figure>

<ul>
<li>通过使用<code>left join</code>进行左连接，不仅会返回两个表满足条件的交集部分，也会返回左边表中的全部数据，而在右表中缺失的数据会使用<code>null</code>来代替（右连接<code>right join</code>同理，只是反过来而已，这里就不再介绍了）：</li>
</ul>
<p>![](D:\Typora\笔记\C++\Boost.Asio C++ NP\images\watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg1ODIwMQ&#x3D;&#x3D;,size_16,color_FFFFFF,t_70-16830127866511.png)</p>
<p><font color = "blue">示例</font>：查询表student和teach的以学号合并的左交集（即显示student表中的全部内容，teach表中没有对应的数据用null表示）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> teach <span class="hljs-keyword">ON</span> student.sid <span class="hljs-operator">=</span> teach.sid;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+------+------+</span><br><span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span> tid  <span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+------+------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span> 小明 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1111</span> <span class="hljs-operator">|</span> 小红 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span>    <span class="hljs-number">2</span> <span class="hljs-operator">|</span> <span class="hljs-number">1111</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1112</span> <span class="hljs-operator">|</span> 小刚 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1113</span> <span class="hljs-operator">|</span> 小芳 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2110</span> <span class="hljs-operator">|</span> 小强 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2111</span> <span class="hljs-operator">|</span> 小丽 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+------+------+</span><br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：在上述示例之上还想要查询老师的信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> teach <span class="hljs-keyword">ON</span> student.sid <span class="hljs-operator">=</span> teach.sid<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> teacher <span class="hljs-keyword">ON</span> teacher.tid <span class="hljs-operator">=</span> teach.tid;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+------+------+------+------+------+</span><br><span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span> tid  <span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> tid  <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+------+------+------+------+------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span> 小明 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span> 张三 <span class="hljs-operator">|</span> 男   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1111</span> <span class="hljs-operator">|</span> 小红 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span>    <span class="hljs-number">2</span> <span class="hljs-operator">|</span> <span class="hljs-number">1111</span> <span class="hljs-operator">|</span>    <span class="hljs-number">2</span> <span class="hljs-operator">|</span> 李四 <span class="hljs-operator">|</span> 女   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1112</span> <span class="hljs-operator">|</span> 小刚 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1113</span> <span class="hljs-operator">|</span> 小芳 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2110</span> <span class="hljs-operator">|</span> 小强 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2111</span> <span class="hljs-operator">|</span> 小丽 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+------+------+------+------+------+</span><br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：查询教师张三交的学生信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> teach <span class="hljs-keyword">ON</span> student.sid <span class="hljs-operator">=</span> teach.sid<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> teacher <span class="hljs-keyword">ON</span> teacher.tid <span class="hljs-operator">=</span> teach.tid <span class="hljs-keyword">WHERE</span> teacher.name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;张三&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+------+------+------+------+------+</span><br><span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span> tid  <span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> tid  <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+------+------+------+------+------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span> 小明 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span> 张三 <span class="hljs-operator">|</span> 男   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1112</span> <span class="hljs-operator">|</span> 小刚 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span> <span class="hljs-number">1112</span> <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span> 张三 <span class="hljs-operator">|</span> 男   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+------+------+------+------+------+</span><br></code></pre></td></tr></table></figure>

<p>#####5.3 嵌套查询</p>
<p>我们可以将查询的结果作为另一个查询的条件，比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 列名 <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> 列名 <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 条件)<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：用嵌套查询教师张三交的学生信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sid <span class="hljs-keyword">in</span> (<span class="hljs-keyword">SELECT</span> sid <span class="hljs-keyword">FROM</span> teach <span class="hljs-keyword">WHERE</span> tid <span class="hljs-keyword">in</span> (<span class="hljs-keyword">SELECT</span> tid <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27; 张三&#x27;</span>));<br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br><span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span> 小明 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1112</span> <span class="hljs-operator">|</span> 小刚 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br>#因为这里嵌套查询返回的sid是一个集合所以用<span class="hljs-keyword">in</span><br></code></pre></td></tr></table></figure>

<p>也可以这样实现：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> s.sid, name, sex <span class="hljs-keyword">FROM</span> student s <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> teach t <span class="hljs-keyword">ON</span> s.sid <span class="hljs-operator">=</span> t.sid<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">WHERE</span> tid <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> tid <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;张三&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br><span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span> 小明 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1112</span> <span class="hljs-operator">|</span> 小刚 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br></code></pre></td></tr></table></figure>

<p>效果是一样的，根据实际情况择优选择。</p>
<p>###八、数据库控制语言（DCL）</p>
<p>####1、什么是DCL</p>
<p>庞大的数据库不可能由一个人来管理，我们需要更多的用户来一起管理整个数据库。</p>
<p>####2、创建用户</p>
<p>我们可以通过<code>create user</code>来创建用户：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> 用户名 identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;密码&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>也可以不带密码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> 用户名;<br></code></pre></td></tr></table></figure>

<p>我们可以通过@来限制用户登录的登录IP地址，<code>%</code>表示匹配所有的IP地址，默认使用的就是任意IP地址。</p>
<p>####3、登录用户</p>
<p>首先需要添加一个环境变量，然后我们通过cmd去登陆mysql：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql <span class="hljs-operator">-</span>u 用户名 <span class="hljs-operator">-</span>p<br></code></pre></td></tr></table></figure>

<p>####4、用户授权</p>
<p>我们可以通过使用<code>grant</code>来为一个数据库用户进行授权：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span><span class="hljs-operator">|</span>权限<span class="hljs-number">1</span>,权限<span class="hljs-number">2.</span>..(列<span class="hljs-number">1</span>,...) <span class="hljs-keyword">ON</span> 数据库.表 <span class="hljs-keyword">TO</span> 用户 [<span class="hljs-keyword">with</span> <span class="hljs-keyword">grant</span> option]<br></code></pre></td></tr></table></figure>

<p>其中all代表授予所有权限，当数据库和表为<code>*</code>，代表为所有的数据库和表都授权。</p>
<p>如果在最后添加了<code>with grant option</code>，那么被授权的用户还能将已获得的授权继续授权给其他用户。</p>
<p>我们可以使用<code>revoke</code>来收回一个权限：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">REVOKE</span> <span class="hljs-keyword">ALL</span><span class="hljs-operator">|</span>权限<span class="hljs-number">1</span>,权限<span class="hljs-number">2.</span>..(列<span class="hljs-number">1</span>,...) <span class="hljs-keyword">ON</span> 数据库.表 <span class="hljs-keyword">FROM</span> 用户<br></code></pre></td></tr></table></figure>



<p>###九、视图</p>
<p>视图本质就是一个查询的结果，并不是真实存在的，数据实际上还是存放在原来的表中。</p>
<p>我们可以通过<code>create view</code>来创建视图;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> 视图名称(列名) <span class="hljs-keyword">as</span> 子查询语句 [<span class="hljs-keyword">WITH</span> <span class="hljs-keyword">CHECK</span> OPTION];<br></code></pre></td></tr></table></figure>

<p>创建后，我们就可以使用<code>select</code>语句来直接查询视图上的数据了，因此，还能在视图的基础上，导出其他的视图。</p>
<p><font color = "blue">示例</font>：创建视图包括查询student表中所有男生的信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> test1 <span class="hljs-keyword">AS</span>  <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;男&#x27;</span>;<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> test1;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br><span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span> 小绿 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1112</span> <span class="hljs-operator">|</span> 小刚 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2110</span> <span class="hljs-operator">|</span> 小强 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+</span><br></code></pre></td></tr></table></figure>

<p><code>WITH CHECK OPTION</code>是指当创建后，如果更新视图中的数据，是否要满足子查询中的条件表达式，不满足将无法插入。</p>
<p><font color = "blue">如上述示例中，不可修改视图中性别的列。</font></p>
<blockquote>
<p>视图的规则：</p>
<ol>
<li>若视图是由两个以上基本表导出的，则此视图不允许更新。</li>
<li>若视图的字段来自字段表达式或常数，则不允许对此视图执行INSERT和UPDATE操作，但允许执行DELETE操作。</li>
<li>若视图的字段来自集函数，则此视图不允许更新。</li>
<li>若视图定义中含有GROUP BY子句，则此视图不允许更新。</li>
<li>若视图定义中含有DISTINCT短语，则此视图不允许更新。</li>
<li>若视图定义中有嵌套查询，并且内层查询的FROM子句中涉及的表也是导出该视图的基本表，则此视图不允许更新。例如将成绩在平均成绩之上的元组定义成一个视图GOOD_SC： CREATE VIEW GOOD_SC AS SELECT Sno, Cno, Grade FROM SC WHERE Grade &gt; (SELECT AVG(Grade) FROM SC); 　　导出视图GOOD_SC的基本表是SC，内层查询中涉及的表也是SC，所以视图GOOD_SC是不允许更新的。</li>
<li>一个不允许更新的视图上定义的视图也不允许更新</li>
</ol>
</blockquote>
<p><font color = "blue">示例</font>：演示用两张基本表创建视图1、视图2，验证规则1和规则7。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">view</span> test1 <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> s.sid, name, sex, tid <span class="hljs-keyword">from</span> student s <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> teach t <span class="hljs-keyword">on</span> s.sid <span class="hljs-operator">=</span> t.sid;<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> test1;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+------+</span><br><span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span> tid  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span> 小明 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1111</span> <span class="hljs-operator">|</span> 小红 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span>    <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1112</span> <span class="hljs-operator">|</span> 小刚 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1113</span> <span class="hljs-operator">|</span> 小芳 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2110</span> <span class="hljs-operator">|</span> 小强 <span class="hljs-operator">|</span> 男  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2111</span> <span class="hljs-operator">|</span> 小丽 <span class="hljs-operator">|</span> 女  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+-----+------+</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">view</span> test2 <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> sid, e.name stu_name, e.sex stu_sex, t.name <span class="hljs-keyword">from</span> test1 e <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> teacher t <span class="hljs-keyword">on</span> e.tid <span class="hljs-operator">=</span> t.tid;<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> test2;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+----------+---------+------+</span><br><span class="hljs-operator">|</span> sid  <span class="hljs-operator">|</span> stu_name <span class="hljs-operator">|</span> stu_sex <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+----------+---------+------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1110</span> <span class="hljs-operator">|</span> 小明     <span class="hljs-operator">|</span> 男      <span class="hljs-operator">|</span> 张三 <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1111</span> <span class="hljs-operator">|</span> 小红     <span class="hljs-operator">|</span> 女      <span class="hljs-operator">|</span> 李四 <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1112</span> <span class="hljs-operator">|</span> 小刚     <span class="hljs-operator">|</span> 男      <span class="hljs-operator">|</span> 张三 <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1113</span> <span class="hljs-operator">|</span> 小芳     <span class="hljs-operator">|</span> 女      <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2110</span> <span class="hljs-operator">|</span> 小强     <span class="hljs-operator">|</span> 男      <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2111</span> <span class="hljs-operator">|</span> 小丽     <span class="hljs-operator">|</span> 女      <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+----------+---------+------+</span><br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">update</span> test2 <span class="hljs-keyword">set</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;赵四&#x27;</span> <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;李四&#x27;</span>;<br>ERROR <span class="hljs-number">1288</span> (HY000): The target <span class="hljs-keyword">table</span> test2 <span class="hljs-keyword">of</span> the <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> updatable<br></code></pre></td></tr></table></figure>



<p>通过<code>drop</code>来删除一个视图：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">view</span> 视图名称<br></code></pre></td></tr></table></figure>



<p>###十、索引</p>
<p>像Hash表一样，它能够快速地定位元素存放的位置，我们可以通过下面的命令创建索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> [索引类型] INDEX<span class="hljs-operator">|</span>KEY 索引名称 <span class="hljs-keyword">ON</span> 表名(列名)<br><span class="hljs-comment">-- 查看表中的索引</span><br><span class="hljs-keyword">show</span> INDEX <span class="hljs-keyword">FROM</span> student<br></code></pre></td></tr></table></figure>

<p>索引类型：</p>
<ul>
<li><p>普通索引：NOMAL（不用特意标明），</p>
</li>
<li><p>唯一索引：UNIQUE，</p>
</li>
<li><p>主键索引：PRIMARY，</p>
</li>
<li><p>全文索引：FULLTEXT</p>
</li>
</ul>
<p>我们也可以通过下面的命令删除一个索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> index 索引名称 <span class="hljs-keyword">on</span> 表名<br></code></pre></td></tr></table></figure>

<blockquote>
<p>虽然添加索引后会使得查询效率更高，但是我们不能过度使用索引，索引为我们带来高速查询效率的同时，也会在数据更新时产生额外建立索引的开销，同时也会占用磁盘资源。</p>
</blockquote>
<p>###十一、触发器</p>
<p>触发器在<code>select</code>&#x2F;<code>update</code>&#x2F;<code>delete</code>条件下会自动触发，触发器通常用于检查内容的安全性，相比直接添加约束，触发器显得更加灵活。</p>
<p>当表上发生<code>select</code>&#x2F;<code>update</code>&#x2F;<code>delete</code>等操作时，激活触发器，会自动生成两个临时的表（<code>new表</code>和<code>old表</code>，只能由触发器使用）。</p>
<p>使用<code>BEFORE</code>希望验证新数据是否满足条件，希望在激活触发器的语句执行之后完成几个或更多的改变，使用<code>AFTER</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> 触发器名称 [BEFORE<span class="hljs-operator">|</span>AFTER] [<span class="hljs-keyword">INSERT</span><span class="hljs-operator">|</span><span class="hljs-keyword">UPDATE</span><span class="hljs-operator">|</span><span class="hljs-keyword">DELETE</span>] <span class="hljs-keyword">ON</span> 表名<span class="hljs-operator">/</span>视图名 <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> 触发程序<br></code></pre></td></tr></table></figure>

<p>在<code>insert</code>操作时，如果原表中没有该数据的话，那么新的内容会被插入到new表中；在<code>delete</code>操作时，删除的内容会被移到old表中；在<code>update</code>操作时，旧的内容会被移到old表中，新的内容会出现在new表中。</p>
<p> <code>FOR EACH ROW</code>表示针对每一行都会生效，无论哪行进行指定操作都会执行触发器！</p>
<p><font color = "blue">示例</font>：在student表中创建触发器，触发条件是当删除student表某一行数据之前，删除的teach表中的sid和old.sid对应的数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> t BEFORE <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">ON</span> student <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> teach <span class="hljs-keyword">WHERE</span> old.sid <span class="hljs-operator">=</span> teach.sid;<br></code></pre></td></tr></table></figure>



<p>###十二、事务</p>
<p>事务具有以下特性：</p>
<ul>
<li><strong>原子性：</strong>一个事务（transaction）中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。</li>
<li><strong>一致性：</strong>在事务开始之前和事务结束以后，数据库的完整性没有被破坏。这表示写入的资料必须完全符合所有的预设规则，这包含资料的精确度、串联性以及后续数据库可以自发性地完成预定的工作。</li>
<li><strong>隔离性：</strong>数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括读未提交（Read uncommitted）、读提交（read committed）、可重复读（repeatable read）和串行化（Serializable）。</li>
<li><strong>持久性：</strong>事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。</li>
</ul>
<p>我们通过以下例子来探究以下事务：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">begin</span>;   #开始事务<br>...<br><span class="hljs-keyword">rollback</span>;  #回滚事务<br><span class="hljs-keyword">savepoint</span> 回滚点;  #添加回滚点<br><span class="hljs-keyword">rollback</span> <span class="hljs-keyword">to</span> 回滚点; #回滚到指定回滚点<br>...<br><span class="hljs-keyword">commit</span>; #提交事务<br><span class="hljs-comment">-- 一旦提交，就无法再进行回滚了！</span><br></code></pre></td></tr></table></figure>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="MySQL高级"><a href="#MySQL高级" class="headerlink" title="MySQL高级"></a>MySQL高级</h2><p>###一、系统函数</p>
<p>####1.1 字符串函数</p>
<p><strong>字符串分割函数</strong>：</p>
<p>起始位置从1开始。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">SUBSTRING</span>(字符串, 起始位置, 结束位置)<span class="hljs-operator">|</span><span class="hljs-keyword">LEFT</span>(字符串, 长度)<span class="hljs-operator">|</span><span class="hljs-keyword">RIGHT</span>(字符串, 长度)<br></code></pre></td></tr></table></figure>

<ul>
<li>left 从最左边向右截取字符串，</li>
<li>right 从最右边向左截取字符串。</li>
</ul>
<p><font color = "blue">示例</font>：获取所有学生姓名的第二个字。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUBSTRING</span>(name, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">FROM</span> student;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">SUBSTRING</span>(name, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br><span class="hljs-operator">|</span> 丽                    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 刚                    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 强                    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 明                    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 红                    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 芳                    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span><br></code></pre></td></tr></table></figure>



<p><strong>大小写转换函数</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">UPPER<span class="hljs-operator">|</span><span class="hljs-built_in">LOWER</span>(<span class="hljs-string">&#x27;字符串&#x27;</span>)<br></code></pre></td></tr></table></figure>



<p><strong>字符替换函数</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">REPLACE(字符串, 原文, 替换文)<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：将查询到的所有同学的名称中的<code>小</code>全部替换<code>大</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> REPLACE(`name`, <span class="hljs-string">&#x27;小&#x27;</span>, <span class="hljs-string">&#x27;大&#x27;</span>) <span class="hljs-keyword">FROM</span> student;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------+</span><br><span class="hljs-operator">|</span> REPLACE(`name`, <span class="hljs-string">&#x27;小&#x27;</span>, <span class="hljs-string">&#x27;大&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------+</span><br><span class="hljs-operator">|</span> 大丽                        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 大刚                        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 大强                        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 大明                        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 大红                        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 大芳                        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------+</span><br></code></pre></td></tr></table></figure>



<p><strong>字符拼接函数</strong>：</p>
<p>连接两个字符串。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">CONCAT(字符串<span class="hljs-number">1</span>, 字符串<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：将查询到的所有同学的名称最后都添加一个<code>子</code>字。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> concat(name, <span class="hljs-string">&#x27;子&#x27;</span>) <span class="hljs-keyword">FROM</span> student;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> concat(name, <span class="hljs-string">&#x27;子&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> 小丽子             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 小刚子             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 小强子             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 小明子             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 小红子             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> 小芳子             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br></code></pre></td></tr></table></figure>



<p><strong>字符串长度函数</strong>：</p>
<p>注意如果使用的是UTF-8编码格式，那么一个汉字占3字节，数字和字母占一个字节。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">LENGTH(字符串)<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：比如我们要获取所有人名字的长度。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> LENGTH(`name`) <span class="hljs-keyword">FROM</span> student;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> LENGTH(`name`) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">6</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">6</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">6</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">6</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">6</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>              <span class="hljs-number">6</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br></code></pre></td></tr></table></figure>

<p><strong>以上函数的操作只对查询的结果生效，不改变原数据。</strong></p>
<p>####1.2 时间函数</p>
<p><strong>日期添加函数</strong>：</p>
<p><code>interval</code>作为关键字，表示时间间隔。</p>
<p>单位有：year（年）、month（月）、day（日）、hour（小时）、minute（分钟）、second（秒）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">DATE_ADD(日期, <span class="hljs-type">interval</span> 增量 单位)<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：比如我们希望让2022-1-1向后5天。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> DATE_ADD(<span class="hljs-string">&#x27;2022-1-1&#x27;</span>,<span class="hljs-type">INTERVAL</span> <span class="hljs-number">5</span> <span class="hljs-keyword">day</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------+</span><br><span class="hljs-operator">|</span> DATE_ADD(<span class="hljs-string">&#x27;2022-1-1&#x27;</span>,<span class="hljs-type">INTERVAL</span> <span class="hljs-number">5</span> <span class="hljs-keyword">day</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2022</span><span class="hljs-number">-01</span><span class="hljs-number">-06</span>                          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------+</span><br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：同理，向前1年。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> DATE_ADD(<span class="hljs-string">&#x27;2022-1-1&#x27;</span>,<span class="hljs-type">INTERVAL</span> <span class="hljs-number">-1</span> <span class="hljs-keyword">year</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------+</span><br><span class="hljs-operator">|</span> DATE_ADD(<span class="hljs-string">&#x27;2022-1-1&#x27;</span>,<span class="hljs-type">INTERVAL</span> <span class="hljs-number">-1</span> <span class="hljs-keyword">year</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">2021</span><span class="hljs-number">-01</span><span class="hljs-number">-01</span>                            <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------+</span><br></code></pre></td></tr></table></figure>



<p><strong>日期计算函数</strong>：</p>
<p>快速计算日期的间隔天数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">DATEDIFF(日期<span class="hljs-number">1</span>, 日期<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：计算2022年的2月有多少天。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> DATEDIFF(<span class="hljs-string">&#x27;2022-3-1&#x27;</span>,<span class="hljs-string">&#x27;2022-2-1&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------+</span><br><span class="hljs-operator">|</span> DATEDIFF(<span class="hljs-string">&#x27;2022-3-1&#x27;</span>,<span class="hljs-string">&#x27;2022-2-1&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------+</span><br><span class="hljs-operator">|</span>                              <span class="hljs-number">28</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------+</span><br></code></pre></td></tr></table></figure>

<p>如果我们想快速获取当前时间的话，可以使用这些：</p>
<ul>
<li><p>curdate()     当前的日期</p>
</li>
<li><p>curtime()     当前的时间</p>
</li>
<li><p>now()    当前的日期+时间</p>
</li>
<li><p>day(curdate() |curtime()|now())    获取日期是几号</p>
</li>
<li><p>month(curdate() |curtime()|now())   获取日期是几月</p>
</li>
<li><p>year(curdate() |curtime()|now())      获取日期是哪一年</p>
</li>
</ul>
<p>####1.3 数学函数</p>
<p>数学函数比较常规，基本与cmath一致：</p>
<ul>
<li><p>abs(x)   求x的绝对值</p>
</li>
<li><p>ceiling(x)   x向上取整</p>
</li>
<li><p>floor(x)  x向下取整</p>
</li>
<li><p>round(x, 精度)  x取四舍五入，遵循小数点精度 </p>
</li>
<li><p>exp(x)   e的x次方</p>
</li>
<li><p>rand()   0-1之间的随机数</p>
</li>
<li><p>log(x)    x的对数</p>
</li>
<li><p>pi()     π</p>
</li>
<li><p>power(x, n)    x的n次方</p>
</li>
<li><p>sqrt(x)     x的平方根</p>
</li>
<li><p>sin(x)  cos(x)   tan(x)     三角函数（貌似没有arctan这类反函数？）</p>
</li>
</ul>
<p>####1.4 类型转换函数</p>
<p>MySQL的类型转换也分为隐式类型转换和显示类型转换。</p>
<p><strong>隐式类型转换</strong>：</p>
<p><font color = "blue">示例</font>：字符串会被进行隐式转换（注意这里并不是按照字符的ASCII码转换，而是写的多少表示多少）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-operator">+</span><span class="hljs-string">&#x27;2&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1</span><span class="hljs-operator">+</span><span class="hljs-string">&#x27;2&#x27;</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+</span><br><span class="hljs-operator">|</span>     <span class="hljs-number">3</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+</span><br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：1会被直接转换为字符串的’1’，隐式类型转换，所以这里得到的结果是’12’。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> CONCAT(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> CONCAT(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">12</span>             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br></code></pre></td></tr></table></figure>



<p><strong>显示类型转换</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">CAST</span>(数据 <span class="hljs-keyword">as</span> 数据类型)<br></code></pre></td></tr></table></figure>

<p>数据类型有以下几种：</p>
<ul>
<li>BINARY[(N)] ：二进制字符串，转换后长度小于N个字节</li>
<li>CHAR[(N)] ：字符串，转换后长度小于N个字符</li>
<li>DATE ：日期</li>
<li>DATETIME ：日期时间</li>
<li>DECIMAL[(M[,N])] ：浮点数，M为数字总位数(包括整数部分和小数部分)，N为小数点后的位数</li>
<li>SIGNED [INTEGER] ：有符号整数</li>
<li>TIME ：时间</li>
<li>UNSIGNED [INTEGER] ：无符号整数</li>
</ul>
<p><font color = "blue">示例</font>：将一个浮点数pi转换为一个整数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(pi() <span class="hljs-keyword">AS</span> SIGNED);<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">CAST</span>(pi() <span class="hljs-keyword">AS</span> SIGNED) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------+</span><br><span class="hljs-operator">|</span>                    <span class="hljs-number">3</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------+</span><br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：将字符串转换为数字，会自动进行扫描，值得注意的是一旦遇到非数字的字符，会停止扫描。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">&#x27;123abc456&#x27;</span> <span class="hljs-keyword">as</span> SIGNED);<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">&#x27;123abc456&#x27;</span> <span class="hljs-keyword">as</span> SIGNED) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------+</span><br><span class="hljs-operator">|</span>                         <span class="hljs-number">123</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------+</span><br></code></pre></td></tr></table></figure>

<p>除了cast以外还有convert函数，功能比较相似，这里就不做讲解了。</p>
<p>####1.5 流程控制函数</p>
<p><strong>逻辑判断函数</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">IF(条件表达式, 结果<span class="hljs-number">1</span>, 结果<span class="hljs-number">2</span>) #类似于三目运算符<br>IFNULL(值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>) #如果值<span class="hljs-number">1</span>为<span class="hljs-keyword">null</span>则返回值<span class="hljs-number">2</span>，否则返回值<span class="hljs-number">1</span><br><span class="hljs-built_in">NULLIF</span>(值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>) #如果值<span class="hljs-number">1</span>与值<span class="hljs-number">2</span>相等则返回<span class="hljs-keyword">null</span>，否则返回值<span class="hljs-number">1</span><br>ISNULL(值) #判断值是否为<span class="hljs-keyword">null</span><br></code></pre></td></tr></table></figure>



<p><strong>分支选择函数</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <br><span class="hljs-keyword">CASE</span> 表达式<br>	<span class="hljs-keyword">WHEN</span> 表达式值 <span class="hljs-keyword">THEN</span><br>		<span class="hljs-keyword">sql</span>语句或结果<br>	<span class="hljs-keyword">ELSE</span><br>		默认<span class="hljs-keyword">sql</span>语句或结果<br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></table></figure>



<p><font color = "blue">示例</font>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CASE</span> <span class="hljs-number">2</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ELSE</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">END</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> switch; #起的别名，忽略这行<br><span class="hljs-operator">+</span><span class="hljs-comment">--------+</span><br><span class="hljs-operator">|</span> switch <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+</span><br><span class="hljs-operator">|</span>      <span class="hljs-number">5</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+</span><br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：也可以将自定义的判断条件放入When之后，它类似于else-if。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CASE</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-number">3</span><span class="hljs-operator">&gt;</span><span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-number">0</span><span class="hljs-operator">&lt;</span><span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">11</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ELSE</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">END</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> elif; #起的别名，忽略这行<br><span class="hljs-operator">+</span><span class="hljs-comment">------+</span><br><span class="hljs-operator">|</span> elif <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">11</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+</span><br></code></pre></td></tr></table></figure>



<p>###二、自定义函数</p>
<p>####2.1 基本语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> 函数名([参数列表]) <span class="hljs-keyword">RETURNS</span> 返回值类型<br><span class="hljs-keyword">BEGIN</span><br>函数体;<br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></table></figure>

<p>用<code>delimiter</code>关键字重载结束符，解决函数体与END关键字冲突。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER $$ #新的结束符为<span class="hljs-string">&#x27;$$&#x27;</span><br></code></pre></td></tr></table></figure>



<p><font color = "blue">示例</font>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> test(i <span class="hljs-type">INT</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">INT</span><br><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">RETURN</span> i <span class="hljs-operator">*</span> i;<br><span class="hljs-keyword">END</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------+</span><br><span class="hljs-operator">|</span> test(<span class="hljs-number">3</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+</span><br><span class="hljs-operator">|</span>       <span class="hljs-number">9</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+</span><br>#在MySQL中创建函数时出现这种错误的解决方法：<br><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> log_bin_trust_function_creators<span class="hljs-operator">=</span><span class="hljs-literal">TRUE</span>;<br></code></pre></td></tr></table></figure>



<p>####2.2 变量</p>
<p>如果我们想要定义一个局部变量，并为其赋值。</p>
<p>定义局部变量的格式为：</p>
<ul>
<li>declare 变量名称 变量类型 [, …]</li>
<li>declare 变量名称 变量类型 default 默认值</li>
</ul>
<p>为变量赋值的格式为：</p>
<ul>
<li>set 变量名称 &#x3D; 值</li>
</ul>
<p><font color = "blue">示例</font>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span>;<br><span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><span class="hljs-keyword">RETURN</span> i <span class="hljs-operator">*</span> i <span class="hljs-operator">*</span> a;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure>

<p>在函数内部使用<code>select</code>语句，可以结合<code>into</code>关键字将查询结果赋值给变量。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span>;<br><span class="hljs-comment">/* select into from 语句 */</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">INTO</span> a <span class="hljs-keyword">FROM</span> student;<br><span class="hljs-comment">/* * * * * * * * * * * */</span><br><span class="hljs-keyword">RETURN</span> a;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure>



<h4 id="2-3-流程控制"><a href="#2-3-流程控制" class="headerlink" title="2.3 流程控制"></a>2.3 流程控制</h4><p><strong>选择语句</strong>：</p>
<p>使用流程控制语句，其中最关键的就是IF判断语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">...<br>IF 判断条件<br><span class="hljs-keyword">THEN</span><br>	<span class="hljs-keyword">sql</span>语句<br><span class="hljs-keyword">ELSE</span><br>	<span class="hljs-keyword">sql</span>语句<br><span class="hljs-keyword">END</span> IF;<br>...<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：以结合<code>exists</code>关键字来判断是否为NULL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br><span class="hljs-comment">-- IF EXISTS(SELECT * FROM student WHERE sid = 100) THEN #如果存在</span><br>IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sid <span class="hljs-operator">=</span> <span class="hljs-number">100</span>) <span class="hljs-keyword">THEN</span> #如果不存在<br>	<span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><span class="hljs-keyword">END</span> IF;<br><span class="hljs-keyword">RETURN</span> a;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure>



<p>也支持switch，与之前不同的是以关键字<code>END CASE</code>结尾。</p>
<p><strong>循环语句</strong>：</p>
<p>MySQL提供了三种循环语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">#WHILE循环<br>WHILE 循环条件 DO ... <span class="hljs-keyword">END</span> WHILE;<br>#LOOP循环<br>循环名称: LOOP ...(配合LEAVE语句退出循环) <span class="hljs-keyword">END</span> POOL 循环名称;<br>#REPEAT循环<br>REPEAT ... UNTIL 结束条件 <span class="hljs-keyword">END</span> REPEAT;<br></code></pre></td></tr></table></figure>



<p><font color = "blue">示例</font>：while循环。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">10</span>;<br>WHILE a <span class="hljs-operator">&lt;</span> <span class="hljs-number">11</span> DO<br>	<span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> a <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">END</span> WHILE;<br><span class="hljs-keyword">RETURN</span> a;<br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：loop循环。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">10</span>;<br>lp1: LOOP<br>	<span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> a <span class="hljs-operator">-</span> <span class="hljs-number">1</span>;<br>		IF a <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span><br>			LEAVE lp1;# 类似于goto<br>		<span class="hljs-keyword">END</span> IF;<br><span class="hljs-keyword">END</span> LOOP lp1;#<span class="hljs-keyword">end</span> XX 当作&#123;XX&#125;方便理解<br><span class="hljs-keyword">RETURN</span> a;<br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：repeat循环。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>REPEAT #类似于do<span class="hljs-operator">-</span>while，先执行再判断<br>	<span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> a <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<br>UNTIL a <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span> REPEAT;<br><span class="hljs-keyword">RETURN</span> a;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure>



<p>####2.4 全局变量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> @变量名 <span class="hljs-operator">=</span> 值;<br></code></pre></td></tr></table></figure>

<p>将全局变量作为参数传递给函数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> func(<span class="hljs-variable">@x</span>);<br></code></pre></td></tr></table></figure>

<p>我们自己定义的变量称为用户变量，系统默认变量称为系统变量。查看系统变量的命令为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">GLOBAL</span> VARIABLES<br></code></pre></td></tr></table></figure>



<p>###三、存储过程</p>
<p>存储过程是一个包括多条SQL语句的集合，专用于特定表的特定操作。</p>
<p>定义存储过程与定义函数极为相似，它也可以包含参数，函数中使用的语句这里也能使用，但是它没有返回值。</p>
<table>
<thead>
<tr>
<th align="center">存储过程px</th>
<th align="center">函数fx</th>
</tr>
</thead>
<tbody><tr>
<td align="center">特定操作，无返回值，sql语句执行者</td>
<td align="center">数据处理，有返回值，sql语句参与者</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">#定义存储过程<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> 名称([形参列表])<br><span class="hljs-keyword">BEGIN</span><br>	<span class="hljs-keyword">sql</span>语句<br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></table></figure>

<p>注意，MySQL的存储过程不具有原子性，当出现错误时，并不会回滚之前的操作，因此需要我们自己来编写事务保证原子性。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">#执行存储过程<br><span class="hljs-keyword">CALL</span> 名称([实参列表]);<br></code></pre></td></tr></table></figure>



<p><font color = "blue">示例</font>：实现查询学生表，如果包含学生<code>小明</code>那么就删除学生，如果不包含，就添加学生。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> test()<br><span class="hljs-keyword">BEGIN</span><br>	IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;小明&#x27;</span>) <span class="hljs-keyword">THEN</span><br>		<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student(name, sid) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;小明&#x27;</span>, <span class="hljs-string">&#x27;1110&#x27;</span>);<br>	<span class="hljs-keyword">ELSE</span><br>		<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;小明&#x27;</span>;<br>	<span class="hljs-keyword">END</span> IF;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure>



<p><strong>游标</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 定义游标<br><span class="hljs-keyword">DECLARE</span> 游标名称 <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">sql</span>语句;<br># 开启游标<br><span class="hljs-keyword">OPEN</span> 游标名称;<br># 使用游标 从顶部开始，每执行一次，向下移动，如果已经在最底部，则触发异常<br><span class="hljs-keyword">FETCH</span> 游标名称 <span class="hljs-keyword">INTO</span> 存储结果的变量;<br>#关闭游标<br><span class="hljs-keyword">CLOSE</span> 游标名称;<br></code></pre></td></tr></table></figure>

<p><code>fetch...into</code>在最底部，会触发异常，用异常处理器处理异常。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">DECLEAR CONTINUE<span class="hljs-operator">|</span>EXIT HANDLER <span class="hljs-keyword">FOR</span> 异常ID 当异常发生时的操作<br></code></pre></td></tr></table></figure>



<p><font color = "blue">示例</font>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 处理异常的版本<br><span class="hljs-keyword">BEGIN</span><br>	# 定义用于存储查询结果的临时变量<br>	<span class="hljs-keyword">DECLARE</span> id <span class="hljs-type">INT</span>;<br>	<span class="hljs-keyword">DECLARE</span> `name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>);<br>	<span class="hljs-keyword">DECLARE</span> sex <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">5</span>);<br>	<span class="hljs-keyword">DECLARE</span> score <span class="hljs-type">INT</span>;<br>	<span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>	# 定义一个游标<br>	<span class="hljs-keyword">DECLARE</span> cur <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student;<br>	# 定义一个异常处理器（句柄）<br>	<span class="hljs-keyword">DECLARE</span> CONTINUE HANDLER <span class="hljs-keyword">FOR</span> <span class="hljs-number">1329</span> <span class="hljs-keyword">SET</span> flag <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">/*必须在游标定义之后编写,</span><br><span class="hljs-comment">flag相当于开关*/</span><br>	<span class="hljs-keyword">OPEN</span> cur;# 开启游标<br>	WHILE flag <span class="hljs-operator">=</span> <span class="hljs-number">0</span> DO<br>		<span class="hljs-keyword">FETCH</span> cur <span class="hljs-keyword">INTO</span> id, `name`, sex, score;<br>		<span class="hljs-keyword">SELECT</span> id, `name`, sex, score;<br>	<span class="hljs-keyword">END</span> WHILE;<br>	<span class="hljs-keyword">CLOSE</span> cur;<br>	<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>; #验证是否正常结束<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure>



<p><strong>限定存储过程的参数传递</strong>:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> 存储过程名称(<span class="hljs-keyword">OUT</span><span class="hljs-operator">|</span><span class="hljs-keyword">IN</span><span class="hljs-operator">|</span><span class="hljs-keyword">INOUT</span> 变量名 变量类型)<br></code></pre></td></tr></table></figure>

<ul>
<li>IN：只读，作为传入参数，无法改变原值，</li>
<li>OUT：只写，无法传入参数，可以改变原值，</li>
<li>INOUT：可读可写。</li>
</ul>
<p><font color = "blue">示例</font>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 定义全局变量<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@globalVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br># 定义存储过程<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> test(<span class="hljs-keyword">OUT</span> a <span class="hljs-type">INT</span>)<br><span class="hljs-keyword">BEGIN</span><br>	<span class="hljs-keyword">SELECT</span> a;<br>	<span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><span class="hljs-keyword">END</span>;<br><br><span class="hljs-keyword">CALL</span> test(<span class="hljs-variable">@globalVar</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">------+</span><br><span class="hljs-operator">|</span> a    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+</span><br><span class="hljs-keyword">select</span> <span class="hljs-variable">@globalVar</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+</span><br><span class="hljs-operator">|</span> <span class="hljs-variable">@x</span>   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">10</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+</span><br></code></pre></td></tr></table></figure>



<p>###四、存储引擎</p>
<p>详见5 - 1 数据表类型。</p>
<p>###五、索引</p>
<p>####5.1 单列索引</p>
<p>普通索引、唯一索引见入门篇（十）。</p>
<p><strong>全文索引</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">#查找全文索引中的字符串<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span> (全文索引的字段) AGAINST (<span class="hljs-string">&#x27;模糊匹配的字符串&#x27;</span>);<br></code></pre></td></tr></table></figure>



<p><font color = "blue">示例</font>：首先创建一张用于测试全文索引的表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> articles (<br>  id <span class="hljs-type">INT</span> UNSIGNED AUTO_INCREMENT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY, #AUTO_INCREMENT是主键自增长<br>  title <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),<br>  body TEXT,<br>  FULLTEXT (body));<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> articles <span class="hljs-keyword">VALUES</span><br>	(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;MySQL Tutorial&#x27;</span>, <span class="hljs-string">&#x27;DBMS stands for DataBase ...&#x27;</span>),<br>	(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;How To Use MySQL Efficiently&#x27;</span>, <span class="hljs-string">&#x27;After you went through a ...&#x27;</span>),<br>	(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;Optimising MySQL&#x27;</span>,<span class="hljs-string">&#x27;In this tutorial we will show ...&#x27;</span>),<br>	(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;1001 MySQL Tricks&#x27;</span>,<span class="hljs-string">&#x27;1. Never run mysqld as root. 2. ...&#x27;</span>),<br>	(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;MySQL vs. YourSQL&#x27;</span>, <span class="hljs-string">&#x27;In the following database comparison ...&#x27;</span>),<br>	(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;MySQL Security&#x27;</span>, <span class="hljs-string">&#x27;When configured properly, MySQL ...&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>最后我们使用全文索引进行模糊匹配：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> articles <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span> (body) AGAINST (<span class="hljs-string">&#x27;database&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------------+------------------------------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> title             <span class="hljs-operator">|</span> body                                     <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------------+------------------------------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> MySQL Tutorial    <span class="hljs-operator">|</span> DBMS stands <span class="hljs-keyword">for</span> DataBase ...             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">5</span> <span class="hljs-operator">|</span> MySQL vs. YourSQL <span class="hljs-operator">|</span> <span class="hljs-keyword">In</span> the following database comparison ... <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------------+------------------------------------------+</span><br></code></pre></td></tr></table></figure>

<p>如果进行模糊匹配的不是一个词语，那么会查找失败。它的效率远高于以下这种写法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> articles <span class="hljs-keyword">WHERE</span> body <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%database%&#x27;</span>;<br></code></pre></td></tr></table></figure>



<h4 id="5-2-组合索引"><a href="#5-2-组合索引" class="headerlink" title="5.2 组合索引"></a>5.2 组合索引</h4><p>注意组合索引在进行匹配时，遵循最左原则（最左边的字段走索引）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">#修改表索引为组合索引<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名<br><span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span> INDEX 索引名(字段<span class="hljs-number">1</span>, 字段<span class="hljs-number">2</span>, ...) <span class="hljs-keyword">USING</span> BTREE;<br></code></pre></td></tr></table></figure>

<p><font color = "blue">示例</font>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> `study`.`student` <br><span class="hljs-keyword">DROP</span> INDEX `idx_name`,<br><span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span> INDEX `idx_name_sex`(`name`, `sex`) <span class="hljs-keyword">USING</span> BTREE;<br></code></pre></td></tr></table></figure>



<p>我们可以使用<code>explain</code>语句（它可以用于分析MySQL到底是如何在执行某条select语句的）来分析查询语句到底有没有通过索引进行匹配。</p>
<p><font color = "blue">示例</font>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;小明&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>![image-20230110114918555](D:\Typora\笔记\C++\Boost.Asio C++ NP\images\image-20230110114918555.png)</p>
<ul>
<li>select_type：查询类型，上面的就是简单查询（SIMPLE）</li>
<li>table：查询的表</li>
<li>type：MySQL决定如何查找对应的记录，效率从高到低：system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; all</li>
<li>possible_keys：执行查询时可能会用到的索引</li>
<li>key：实际使用的索引</li>
<li>key_len：Mysql在索引里使用的字节数，字段的最大可能长度</li>
<li>rows：扫描的行数</li>
<li>extra：附加说明</li>
</ul>
<p>唯一索引效率是const，组合索引遵循最左原则，查找所有字段时效率最高。</p>
<p>###六、锁</p>
<h4 id="6-1-锁机制"><a href="#6-1-锁机制" class="headerlink" title="6.1 锁机制"></a>6.1 锁机制</h4><p>可以利用锁机制来保证多线程之间的安全性。</p>
<p><strong>隔离级别</strong>：</p>
<ul>
<li>读未提交(Read Uncommitted)：能够读取到其他事务中未提交的内容，存在脏读问题。</li>
<li>读已提交(Read Committed RC)：只能读取其他事务已经提交的内容，存在不可重复读问题。</li>
<li>可重复读(Repeated Read RR)：在读取某行后不允许其他事务操作此行，直到事务结束，但是依然存在幻读问题。</li>
<li>串行读(Serializable)：一个事务的开始必须等待另一个事务的完成。</li>
</ul>
<p>####6.2 读锁写锁</p>
<p>锁分为读锁和写锁：</p>
<ul>
<li><strong>读锁：</strong>也叫<strong>共享锁</strong>，当一个事务添加了读锁后，其他的事务也可以添加读锁或是读取数据，但是不能进行写操作，只能等到所有的读锁全部释放。</li>
<li><strong>写锁：</strong>也叫<strong>排他锁</strong>，当一个事务添加了写锁后，其他事务不能读不能写也不能添加任何锁，只能等待当前事务释放锁。</li>
</ul>
<p>####6.3 全局锁、表锁、行锁</p>
<p><strong>全局锁</strong>：锁作用于全局，整个数据库的所有操作全部受到锁限制。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 开启全局锁<br>flush tables <span class="hljs-keyword">with</span> read lock;<br># 关闭全局锁<br>unlock tables;<br></code></pre></td></tr></table></figure>

<p>除了手动释放锁之外，当会话结束后，锁也会被自动释放。</p>
<p><strong>表锁</strong>：锁作用于整个表，所有对表的操作都会收到锁限制。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 对某一表加锁<br>lock <span class="hljs-keyword">table</span> 表名称 read<span class="hljs-operator">/</span>write;<br></code></pre></td></tr></table></figure>

<p>在我们为表添加写锁后，我们发现其他地方是无法访问此表的，一律都被阻塞。</p>
<p><strong>行锁</strong>：</p>
<p>（仅）<code>InnoDB</code>支持了行锁（Record Locks），我们可以使用以下命令来对某一行进行加锁：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 添加读锁（共享锁）</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> ... lock <span class="hljs-keyword">in</span> share mode;<br><span class="hljs-comment">-- 添加写锁（排他锁）</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> ... <span class="hljs-keyword">for</span> <span class="hljs-keyword">update</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>InnoDB中在更新、删除、插入时，自动加排他锁，直至事务提交，普通查询时不加锁。</li>
<li>MyISAM中在更新、删除、插入时，自动加排他锁，直至事务提交，普通查询时加共享锁。</li>
</ul>
<p><strong>如果某个加锁操作没有使用到索引，那么该锁就会退化为<code>表锁</code>。</strong></p>
<p>不同情况下行锁不同：</p>
<p>#####6.3.1 记录锁(Record Locks)</p>
<p>记录锁, 仅仅锁住索引记录的一行，在单条索引记录上加锁。</p>
<p>记录锁存在于包括<code>主键索引</code>在内的<code>唯一索引</code>中，锁定单条索引记录。</p>
<p>#####6.3.2 间隙锁(Gap Locks)</p>
<p>间隙锁仅仅锁住一个索引区间（开区间，不包括双端端点）。</p>
<p>间隙锁存在于<code>非唯一索引</code>中，比如在非唯一索引区间1、2中，间隙锁的可能值有 (-∞, 1)，(1, 2)，(2, +∞)，间隙锁可用于防止幻读，保证索引间的不会被插入数据。</p>
<h5 id="6-3-3-临键锁-Next-Key-Locks"><a href="#6-3-3-临键锁-Next-Key-Locks" class="headerlink" title="6.3.3 临键锁(Next-Key Locks)"></a>6.3.3 临键锁(Next-Key Locks)</h5><p>临键锁存在于<code>非唯一索引</code>中，该类型的每条记录的索引上都存在这种锁，它是一种特殊的<strong>间隙锁</strong>，锁定一段<code>左开右闭</code>的索引区间。</p>
<p>默认情况下，<code>InnoDB</code>正是使用Next-key Locks来锁定记录（如select … for update语句）它还会根据场景进行灵活变换：</p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th>转换</th>
</tr>
</thead>
<tbody><tr>
<td align="left">使用唯一索引进行精确匹配，但表中不存在记录</td>
<td>自动转换为 Gap Locks</td>
</tr>
<tr>
<td align="left">使用唯一索引进行精确匹配，且表中存在记录</td>
<td>自动转换为 Record Locks</td>
</tr>
<tr>
<td align="left">使用非唯一索引进行精确匹配</td>
<td>不转换</td>
</tr>
<tr>
<td align="left">使用唯一索引进行范围匹配</td>
<td>不转换，但是只锁上界，不锁下界</td>
</tr>
</tbody></table>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/MySQL/">#MySQL</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MySQL</div>
      <div>http://example.com/2023/05/02/MySQL/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>王小白</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年5月2日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/04/24/Hello/" title="Hello">
                        <span class="hidden-mobile">Hello</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>框架：Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>主题：Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
